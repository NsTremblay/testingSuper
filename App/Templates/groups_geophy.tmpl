<!DOCTYPE html>
<html>

<head>

    <TMPL_INCLUDE NAME="header2.tmpl">
    <link rel="stylesheet" href="/App/Styling/css/superphy_menu.css">
    <script type="text/javascript" src="/App/Lib/js/superphy_user_groups.js"></script>
    <script type="text/javascript">
    var page_name = "geophy";
    </script>

    <style type="text/css">
    input[type=checkbox] {
        float: left;
        margin-right: 0.4em;
    }
    .cluster {
        /*display: none;*/
    }
    </style>
    
</head>

<body>

    <TMPL_INCLUDE NAME="page_top.tmpl">

    <div id="geophy-control"></div>

    <div class="row" id="groups-geophy">
        <div class="col-md-6" id="groups_map"></div>
        <div class="col-md-6" id="groups_tree"></div>
    </div>

    <TMPL_INCLUDE NAME="page_bottom.tmpl">

</body>


<script type="text/javascript">
var public_genomes = <TMPL_VAR public_genomes>;
var private_genomes = <TMPL_VAR  private_genomes>;
var tree = <TMPL_VAR tree_json>;
var user_groups = <TMPL_VAR user_groups>;

var user_groups_menu = new UserGroups(user_groups, $('.user-groups-menu'));

//TODO: This is bloated and needs to be changed.
var geophy = new GeoPhy(public_genomes, private_genomes, viewController, null, $('#groups_tree'), $('#groups_map'));
geophy.init(false);

$(document).ready( function () {    
    $('.map-manifest-wrapper').removeClass('col-md-6').addClass('col-md-12');
    $('.map-search-wrapper').removeClass('col-md-6').addClass('col-md-12');
    //Removed the dl view for now. Need to set the styling properly on this
    $('.download-view').empty();
});

//TEST: Script for creating groups
// Pull this into coffee script.
//TODO: Making this a new class in coffeescript

if (user_groups.status) {
    //$('.user-groups-menu').append('<div class="alert alert-info" role="alert">'+user_groups.status+'</div>'); 
}
else {

    //Append the user groups to .user-groups-menu 
    var user_groups_dropdown = $('<div class="dropdown"></div>');
    var user_groups_dd_button = $('<button class="btn btn-default dropdown-toggle" type="button" id="user-group-collection-dropdown-dropdown" data-toggle="dropdown">My Saved Groups <span class="caret"></span></button>').appendTo(user_groups_dropdown);

    var user_groups_dd_list = $('<ul class="dropdown-menu" role="menu" aria-labelledby="user-group-collection-dropdown"></ul>').appendTo(user_groups_dropdown);

/*    var user_group_collections = {
        group_collections : {}
    };
*/

/*    $.each(user_groups, function(collection_name, groups_array) {
        if(collection_name == 'genome_id') return;
        user_group_collections.group_collections[collection_name] = {};
        $('<li role="presentation" class="divider"></li>').appendTo(user_groups_dd_list);
        $('<li role="presentation" class="dropdown-header">Collection: '+collection_name+'</li>').appendTo(user_groups_dd_list);
        $.each(groups_array, function(index,group){
            if(!user_group_collections.group_collections[collection_name][group]) {
                user_group_collections.group_collections[collection_name][group] = [];
                $('<li role="presentation"><a role="menuitem" tabindex="-1" href="#">'+group+'</a></li>').appendTo(user_groups_dd_list);
            }
            else {
                user_group_collections.group_collections[collection_name][group].push(user_groups.genome_id[index]);
            }
        });
    });

    user_groups_dropdown.appendTo($('.user-groups-menu'));*/

}
</script>

</html>