<!DOCTYPE html>
<html>

<TMPL_INCLUDE NAME="header.tmpl">

<TMPL_INCLUDE NAME="nav_bar.tmpl">

<script src="/App/Styling/js/jquery-1.9.1.js"></script>
<script src="/App/Styling/js/jquery-ui-1.10.1.js"></script>
<link rel="stylesheet" href="/App/Styling/css/jquery-ui-1.10.1.css">

<body onload="onLoadCheck()" style="background-color:#796e6c">

	<div class="container" style="background-color:#FFFFFF">

		<!--div align="right" class="bs-docs-sidenav affix" data-spy="affix" data-offset="10" id="jsonTest"></div-->

		<div style="margin:10px 10px 10px 10px;padding:10px 10px 10px 10px">
			<h1>Bioinfo Page - Virulence and AMR Factors</h1>
		</div>

		<TMPL_INCLUDE NAME="virulence_amr_by_strain_form.tmpl">

		<div class="row-fluid" style="max-height:500px;overflow:auto">
			<table class="table table-striped table-condensed">
				<thead>
					<td></td>
					<TMPL_LOOP NAME=STRAINTABLENAMES>
					<td><TMPL_VAR NAME=strain_name></td>
					</TMPL_LOOP>
				</thead>
				<tbody>
					<TMPL_LOOP NAME=vFACTORSBYSTRAIN>
					<tr>
						<td><TMPL_VAR NAME=gene_name></td>
						<TMPL_LOOP NAME=presence_absence><td><TMPL_VAR NAME=value></td></TMPL_LOOP>
					</tr>
					</TMPL_LOOP>
				</tbody>
			</table>
		</div>

		<div class="row-fluid" style="max-height:500px;overflow:auto">
			<table class="table table-striped table-condensed">
				<thead>
					<td></td>
					<TMPL_LOOP NAME=STRAINTABLENAMES>
					<td><TMPL_VAR NAME=strain_name></td>
					</TMPL_LOOP>
				</thead>
				<tbody>
					<TMPL_LOOP NAME=amrFACTORSBYSTRAIN>
					<tr>
						<td><TMPL_VAR NAME=gene_name></td>
						<TMPL_LOOP NAME=presence_absence><td><TMPL_VAR NAME=value></td></TMPL_LOOP>
					</tr>
					</TMPL_LOOP>
				</tbody>
			</table>
		</div>

		<div class="row-fluid">

			<div class="span4" style="margin:10px 10px 10px 10px;padding:10px 10px 0px 10px;border-style:solid;border-width:1px;border-color:#d3d3d3">
				<p> Here you will find information about all virluence factors in the database. This is mostly to provide general
					biological information about each virulence factor.
				</p>
				<hr/>
				<form class="form" action="/virulence_factors/" method="post" enctype="application/x-www-form-urlencoded">
					<fieldset>
						<h5>Select a VF from the list:</h5>
						<select id="vfList" class="span12" name="VFName">
							<TMPL_LOOP NAME=vFACTORS>
							<option value='<TMPL_VAR NAME=FEATUREID>'><TMPL_VAR NAME=UNIQUENAME></option>
							</TMPL_LOOP>
						</select>
						<div style="margin:10px 0px 0px 0px">
							<button id="showSSInfo" type="submit" class="btn btn-small btn-primary" value="Submit"><i class="icon-info-sign icon-white"></i> Virulence Factor Meta Info</button>
							<button type="reset" class="btn btn-small btn-danger" name="cancel" value="Cancel"><i class="icon-remove icon-white"></i> Cancel</button>
						</div>
					</fieldset>
				</form>
			</div>

			<div class="span7">
				<div class="row-fluid">
					<div id="VFMetaInfo" style="margin:10px 10px 10px 10px;padding:10px 10px 0px 10px;display:none">
						<h5><u>Virulence Factor Meta Info</u></h5>
						<TMPL_LOOP NAME=vFMETAINFO>
						<TMPL_VAR NAME=vFUNIQUENAME>
						<strong><TMPL_VAR NAME=vFTERMNAME></strong> : <TMPL_VAR NAME=vFTERMVALUE> <br>
						</TMPL_LOOP>
					</div>

					<div id="vfvalidator" style="display:none"><TMPL_VAR NAME=vfVALIDATOR></div>
				</div>
			</div>

		</div>

		<div class="row-fluid">
			<div class="span4" style="margin:10px 10px 10px 10px;padding:10px 10px 0px 10px;border-style:solid;border-width:1px;border-color:#d3d3d3">
				<p> Here you will find information about all AMR factors in the database. This is mostly to provide general biological information about each AMR factor.
				</p>
				<hr/>
				<form class="form" action="/virulence_factors/" method="post" enctype="application/x-www-form-urlencoded">
					<fieldset>
						<h5>Select an AMR gene from the list:</h5>
						<select class="span12" name="AMRName">
							<TMPL_LOOP NAME=amrFACTORS>
							<option value='<TMPL_VAR NAME=FEATUREID>'><TMPL_VAR NAME=UNIQUENAME></option>
							</TMPL_LOOP>
						</select>
						<div style="margin:10px 0px 0px 0px">
							<button id="showSSInfo" type="submit" class="btn btn-small btn-primary" value="Submit"><i class="icon-info-sign icon-white"></i> AMR Factor Meta Info</button>
							<button type="reset" class="btn btn-small btn-danger" name="cancel" value="Cancel"><i class="icon-remove icon-white"></i> Cancel</button>
						</div>
					</fieldset>
				</form>
			</div>

			<div class="span7">
				<div class="row-fluid">
					<div id="AMRMetaInfo" style="margin:10px 10px 10px 10px;padding:10px 10px 0px 10px;display:none">
						<h5><u>Antimicrobial Resistance Gene Meta Info</u></h5>
						<TMPL_LOOP NAME=amrMETAINFO>
						<TMPL_VAR NAME=amrUNIQUENAME>
						<strong><TMPL_VAR NAME=amrTERMNAME></strong> : <TMPL_VAR NAME=amrTERMVALUE> <br>
						</TMPL_LOOP>
					</div>

					<div id="amrvalidator" style="display:none"><TMPL_VAR NAME=amrVALIDATOR></div>
				</div>
			</div>

		</div>

	</div>
</body>
<TMPL_INCLUDE NAME="footer.tmpl">

</html>

<script type="text/javascript">

var FEATURE_TABLE_JSON = <TMPL_VAR NAME=strainJSONData>;
/* 
Back lists that will get called to the client after page has loaded.
These remain as global constants.
*/
var ISOLATION_LOCATION_JSON = {};
var SEROTYPE_JSON = {};
var ISOLATION_HOST_JSON = {};
var ISOLATION_SOURCE_JSON = {};
var ISOLATION_DATE_JSON = {};

//List of public feature ids used to get data for view switching 
var featureIdList = "";
$(document).ready(function() {
	for (i=0 ; i<FEATURE_TABLE_JSON.data.length-1 ; i++) {
		featureIdList = featureIdList + String(FEATURE_TABLE_JSON.data[i].feature_id) + ",";
	}
	featureIdList = featureIdList + String(FEATURE_TABLE_JSON.data[FEATURE_TABLE_JSON.data.length-1].feature_id);
});

/*Functions set here*/
function onLoadCheck() {
	initialize();
}


//Will initialize the map and grab all of the lists needed for form switching.
function initialize() {
	checkVARValidator();
	getBackList('/isolation_location_form' , ISOLATION_LOCATION_JSON, 'isolationLocationLabel', 'isolationLocationView');
	getBackList("/serotype_form" , SEROTYPE_JSON, 'serotypeViewLabel', 'serotypeView');
	getBackList("/host_source_form" , ISOLATION_HOST_JSON, 'isolationHostLabel', 'isolationHostView');
	getBackList("/isolation_source_form" , ISOLATION_SOURCE_JSON, 'isolationSourceLabel', 'isolationSourceView');
	getBackList("/isolation_date_form" , ISOLATION_DATE_JSON, 'isolationDateLabel', 'isolationDateView');
	getBackList('/isolation_location_form' , ISOLATION_LOCATION_JSON, 'isolationLocationLabel', 'isolationLocationView');
}

function checkVARValidator() {
	if ($('#amrvalidator').is(':empty') && $('#vfvalidator').is(':empty')) {
	}
	else if (!($('#vfvalidator').is(':empty'))){
		$('#VFMetaInfo').show("slow");
	}
	else {
		$('#AMRMetaInfo').show("slow");
	}
}

function getBackList(urlName,formType,labelId,radioId) {
	$.ajax({
		type: "POST",
		url: urlName,
		data: { public_id_list: featureIdList }
	}).done(function (returned_data) {
		formType.json = $.parseJSON(returned_data);
		$('#'+radioId).attr('disabled',false);
	});
}

/*
The next functions are for switching form views:
*/

$('#commonNameView').click(function () {
	showCommonNames(FEATURE_TABLE_JSON);
});
$('#accessionNumberView').click(function () {
	showAccessionNumbers(FEATURE_TABLE_JSON);
});
$('#isolationHostView').click(function () {
	changeListView(ISOLATION_HOST_JSON.json);
});
$('#isolationSourceView').click(function () {
	changeListView(ISOLATION_SOURCE_JSON.json);
});
$('#serotypeView').click(function () {
	changeListView(SEROTYPE_JSON.json);
});
$('#isolationDateView').click(function () {
	changeListView(ISOLATION_DATE_JSON.json);
});
$('#isolationLocationView').click(function () {
	changeListView(ISOLATION_LOCATION_JSON.json);
});

function showCommonNames(featureJsonList) {
	$('#pubStrainList').empty();
	$('#group1 li').closest('li').remove();
	$('#buttonRemoveGroup1').hide();
	$('#group2 li').closest('li').remove();
	$('#buttonRemoveGroup2').hide();

	for (i=0 ; i<featureJsonList.data.length ; i++) {
		var li = document.createElement("li");
		var label = document.createElement("label");
		var description = document.createTextNode(featureJsonList.data[i].name);
		var checkbox = document.createElement("input");

		li.setAttribute("style","list-style:none");

		label.className = "checkbox";

		checkbox.type = "checkbox";
		checkbox.id = "checkboxName";
		checkbox.name = "multiStrainNames";
		checkbox.value = featureJsonList.data[i].feature_id;

		label.appendChild(checkbox);
		label.appendChild(description);
		li.appendChild(label);

		document.getElementById('pubStrainList').appendChild(li);
	}
}

function showAccessionNumbers(featureJsonList) {

	$('#pubStrainList').empty();
	$('#group1 li').closest('li').remove();
	$('#buttonRemoveGroup1').hide();
	$('#group2 li').closest('li').remove();
	$('#buttonRemoveGroup2').hide();

	for (i=0 ; i<featureJsonList.data.length ; i++) {

		var li = document.createElement("li");
		var label = document.createElement("label");
		var description = document.createTextNode(featureJsonList.data[i].dbxref.accession);

		var checkbox = document.createElement("input");

		li.setAttribute("style","list-style:none");

		label.className = "checkbox";

		checkbox.type = "checkbox";
		checkbox.id = "checkboxName";
		checkbox.name = "multiStrainNames";
		checkbox.value = featureJsonList.data[i].feature_id;

		label.appendChild(checkbox);
		label.appendChild(description);
		li.appendChild(label);

		document.getElementById('pubStrainList').appendChild(li);
	}
}

function changeListView(jsonList) {
	$('#pubStrainList').empty();
	$('#strainListForm span').show();
	$('#group1 li').closest('li').remove();
	$('#buttonRemoveGroup1').hide();
	$('#group2 li').closest('li').remove();
	$('#buttonRemoveGroup2').hide();

	for (i=0 ; i<jsonList.data.length ; i++) {
		var li = document.createElement("li");
		var label = document.createElement("label");
		var description = document.createTextNode(jsonList.data[i].common_name + ' - ' + jsonList.data[i].value);	

		var checkbox = document.createElement("input");

		li.setAttribute("style","list-style:none");

		label.className = "checkbox";

		checkbox.type = "checkbox";
		checkbox.id = "checkboxName";
		checkbox.name = "multiStrainNames";
		checkbox.value = jsonList.data[i].feature_id;

		label.appendChild(checkbox);
		label.appendChild(description);
		li.appendChild(label);

		document.getElementById('pubStrainList').appendChild(li);
	}
}

</script>

