	
<!DOCTYPE html>
<html>

<TMPL_INCLUDE NAME="header.tmpl">

<script src="/App/Styling/js/jquery-1.9.1.js"></script>
<script src="/App/Styling/js/jquery-ui-1.10.1.js"></script>
<link rel="stylesheet" href="/App/Styling/css/jquery-ui-1.10.1.css">


<TMPL_INCLUDE NAME="nav_bar.tmpl">

<body onload="onLoadCheck()" style="background-color:#796e6c">
	<div class="container" style="background-color:#FFFFFF">

		<div style="margin:10px 10px 10px 10px;padding:10px 10px 10px 10px">
			<h1>Group Wise Comparisons</h1>
		</div>

		<div>
			<TMPL_INCLUDE NAME="group_wise_comparison_form.tmpl">
		</div>

		<span class="help-block" style="padding:10px">Soon you will be able to select groups of strains from the map or the phylogenetic tree, but they are both shown here for reference as to what the site will look like</span>
		
		<div class="tabbable tabs-left">
			
			<ul class="nav nav-tabs">
				<li class="active"><a href="#mapTreeSelect" data-toggle="tab">Strain Selections</a></li>
				<li id="groupWiseDataLink" style="display:none"><a href="#groupWiseData" data-toggle="tab">Data</a></li>
			</ul>
			
			<div class="tab-content">
				
				<div class="tab-pane active" id="mapTreeSelect">
					
					<div class="tabbable">
						
						<ul class="nav nav-tabs">
							<li class="active"><a href="#mapSelect" data-toggle="tab">Select from Map</a></li>
						</ul>

						<div class="tab-content">
							
							<div class="tab-pane active" id="mapSelect">
								<div id="map_div" style="border-style:solid;border-width:1px;border-color:#d3d3d3;margin:0px 10px 10px 0px;padding:10px">
									<div id="map_canvas" style="height:300px"></div>
								</div>
							</div>

						</div>

					</div>

				</div>

				<div class="tab-pane" id="groupWiseData">

					<div class="tabbable">

						<ul class="nav nav-tabs">
							<li class="active"><a href="#binaryData" data-toggle="tab">Binary Data</a></li>
							<li><a href="#snpData" data-toggle="tab">SNP Data</a></li>
							<li><a href="#groupWisePhyloTree" data-toggle="tab">Phylogram</a></li>
						</ul>

						<div class="tab-content">
							<div class="tab-pane active" id="binaryData">
								<div class="row-fluid">
									<h4 style="margin:10px">Binary Data</h5>
										<div class="span5" style="margin:10px;height:300px;overflow:auto">
											<table class="table table-striped table-condensed">
												<thead>Group 1</thead>
												<tr>
													<th>Locus Name</th>
													<th>Strains Present</th>
													<th>Strains Absent</th>
													<th>p-value</th>
												</tr>
												<TMPL_LOOP NAME=GROUP1BINARYDATA>
												<tr><td><TMPL_VAR NAME=locusname>
													<td><a id="strainsPresent" title="Strains: <TMPL_LOOP NAME=present><a><TMPL_VAR NAME=strain></a> </TMPL_LOOP>"><TMPL_VAR NAME=present_count></a></td>
													<td><a id ="strainsAbsent" title="Strains: <TMPL_LOOP NAME=absent><a><TMPL_VAR NAME=strain></a> </TMPL_LOOP>"><TMPL_VAR NAME=absent_count></a></td>
													<td>< 0.001</td>
												</td></tr></TMPL_LOOP>
											</table>
										</div>

										<div class="span5 pull-right" style="margin:10px;height:300px;overflow:auto">
											<table class="table table-striped table-condensed">
												<thead>Group 2</thead>
												<tr>
													<th>Locus Name</th>
													<th>Strains Present</th>
													<th>Strains Absent</th>
													<th>p-value</th>
												</tr>
												<TMPL_LOOP NAME=GROUP2BINARYDATA>
												<tr><td><TMPL_VAR NAME=locusname>
													<td><a id="strainsPresent" title="Strains: <TMPL_LOOP NAME=present><a><TMPL_VAR NAME=strain></a> </TMPL_LOOP>"><TMPL_VAR NAME=present_count></a></td>
													<td><a id ="strainsAbsent" title="Strains: <TMPL_LOOP NAME=absent><a><TMPL_VAR NAME=strain></a> </TMPL_LOOP>"><TMPL_VAR NAME=absent_count></a></td>
													<td>< 0.001</td>
												</td></tr></TMPL_LOOP>
											</table>
										</div>

									</div>
								</div>

								<div class="tab-pane" id="snpData">
									<div class="row-fluid">
										<h4 style="margin:10px">SNP Data</h5>
											<div class="span5" style="margin:10px;height:300px;overflow:auto">
												<table class="table table-striped table-condensed">
													<thead>Group 1</thead>
													<tr>
														<th>Locus Name</th>
														<th>A</th>
														<th>T</th>
														<th>C</th>
														<th>G</th>
														<th>p-value</th>
													</tr>
													<TMPL_LOOP NAME=GROUP1SNPDATA>
													<tr><td><TMPL_VAR NAME=locusname>
														<td><a id="adeninePresent" title="Strains: <TMPL_LOOP NAME=adenine><TMPL_VAR NAME=strain> </TMPL_LOOP>"><TMPL_VAR NAME=adenine_count></a></td>
														<td><a id="thymidinePresent" title="Strains: <TMPL_LOOP NAME=thymidine><TMPL_VAR NAME=strain> </TMPL_LOOP>"><TMPL_VAR NAME=thymidine_count></a></td>
														<td><a id="cytosinePresent" title="Strains: <TMPL_LOOP NAME=cytosine><TMPL_VAR NAME=strain> </TMPL_LOOP>"><TMPL_VAR NAME=cytosine_count></a></td>
														<td><a id="guaninePresent" title="Strains: <TMPL_LOOP NAME=guanine><TMPL_VAR NAME=strain> </TMPL_LOOP>"><TMPL_VAR NAME=guanine_count></a></td>
														<td>< 0.001</td>
													</td></tr></TMPL_LOOP>
												</table>
											</div>

											<div class="span5 pull-right" style="margin:10px;height:300px;overflow:auto">
												<table class="table table-striped table-condensed">
													<thead>Group 2</thead>
													<tr>
														<th>Locus Name</th>
														<th>A</th>
														<th>T</th>
														<th>C</th>
														<th>G</th>
														<th>p-value</th>
													</tr>
													<TMPL_LOOP NAME=GROUP2SNPDATA>
													<tr><td><TMPL_VAR NAME=locusname>
														<td><a id="adeninePresent" title="Strains: <TMPL_LOOP NAME=adenine><TMPL_VAR NAME=strain> </TMPL_LOOP>"><TMPL_VAR NAME=adenine_count></a></td>
														<td><a id="thymidinePresent" title="Strains: <TMPL_LOOP NAME=thymidine><TMPL_VAR NAME=strain> </TMPL_LOOP>"><TMPL_VAR NAME=thymidine_count></a></td>
														<td><a id="cytosinePresent" title="Strains: <TMPL_LOOP NAME=cytosine><TMPL_VAR NAME=strain> </TMPL_LOOP>"><TMPL_VAR NAME=cytosine_count></a></td>
														<td><a id="guaninePresent" title="Strains: <TMPL_LOOP NAME=guanine><TMPL_VAR NAME=strain> </TMPL_LOOP>"><TMPL_VAR NAME=guanine_count></a></td>
														<td>< 0.001</td>
													</td></tr></TMPL_LOOP>
												</table>
											</div>
										</div>
									</div>

									<div class="tab-pane" id="groupWisePhyloTree">
										<div id="svgCanvas" style="padding:5px">
											<TMPL_INCLUDE NAME="phylogeny_group_wise_comparisons.tmpl">
										</div>
									</div>

								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div id="validator" style="display:none"><TMPL_VAR NAME=VALIDATOR></div>

		</body>

		<TMPL_INCLUDE NAME="footer.tmpl">

		<script type="text/javascript">
		function initialize() {

			var LatLng1 = new google.maps.LatLng(49.134890, -122.901435);
			var LatLng2 = new google.maps.LatLng(-15.6778, -47.4384);
			var LatLng3 = new google.maps.LatLng(53.1142, 2.5771);
			var LatLng4 = new google.maps.LatLng(22.3000, 114.1667);
			var LatLng5 = new google.maps.LatLng(46.0000, 2.0000);
			var LatLng6 = new google.maps.LatLng(0.4252, 36.7517);

			var mapOptions = {	
				center: LatLng1,
				zoom: 1,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			};

			var map = new google.maps.Map(document.getElementById("map_canvas"),
				mapOptions);

			var marker = new google.maps.Marker({
				position: LatLng1,
				map: map
			});

			var marker = new google.maps.Marker({
				position: LatLng2,
				map: map
			});

			var marker = new google.maps.Marker({
				position: LatLng3,
				map: map
			});

			var marker = new google.maps.Marker({
				position: LatLng4,
				map: map
			});

			var marker = new google.maps.Marker({
				position: LatLng5,
				map: map
			});

			var marker = new google.maps.Marker({
				position: LatLng6,
				map: map
			});
		}

		function displayMap() {
			document.getElementById('map_canvas').style.display="block";
			initialize();
		}
		</script>

		<script>
		$(document).ready(function(){
			$('#mapSelect').click(function() {
				$('#map_canvas').delay('700').fadeIn();
				setTimeout(loadScript,1000);
			}); 
		});

		$(function (){
			$.widget("ui.tooltip" , $.ui.tooltip, {
				options: {
					content: function () {
						return $(this).prop('title')
					}
				}
			});
			$('a').tooltip();
		});

		var featureTableJson = <TMPL_VAR NAME=strainJSONData>;

		$('#commonNameView').click(function () {

			$('#pubStrainList').empty();
			$('#group1 li').closest('li').remove();
			$('#buttonRemoveGroup1').hide();
			$('#group2 li').closest('li').remove();
			$('#buttonRemoveGroup2').hide();

			for (i=0 ; i<featureTableJson.data.length ; i++) {
				var li = document.createElement("li");
				var label = document.createElement("label");
				var description = document.createTextNode(featureTableJson.data[i].name);
				var checkbox = document.createElement("input");

				li.setAttribute("style","list-style:none");

				label.className = "checkbox";

				checkbox.type = "checkbox";
				checkbox.id = "checkboxName";
				checkbox.name = "multiStrainNames";
				checkbox.value = featureTableJson.data[i].feature_id;

				label.appendChild(checkbox);
				label.appendChild(description);
				li.appendChild(label);

				document.getElementById('pubStrainList').appendChild(li);
			}
		});

		$('#accessionNumberView').click(function () {

			$('#pubStrainList').empty();
			$('#group1 li').closest('li').remove();
			$('#buttonRemoveGroup1').hide();
			$('#group2 li').closest('li').remove();
			$('#buttonRemoveGroup2').hide();

			for (i=0 ; i<featureTableJson.data.length ; i++) {

				var li = document.createElement("li");
				var label = document.createElement("label");
				var description = document.createTextNode(featureTableJson.data[i].dbxref.accession);

				var checkbox = document.createElement("input");

				li.setAttribute("style","list-style:none");

				label.className = "checkbox";

				checkbox.type = "checkbox";
				checkbox.id = "checkboxName";
				checkbox.name = "multiStrainNames";
				checkbox.value = featureTableJson.data[i].feature_id;

				label.appendChild(checkbox);
				label.appendChild(description);
				li.appendChild(label);

				document.getElementById('pubStrainList').appendChild(li);
			}
		});

/*
The remainder of the data switches will require ajax calls to the server to update forms
*/

$(document).ready( function(){
	var featureIdList = "";
	for (i=0 ; i<featureTableJson.data.length-1 ; i++) {
		featureIdList = featureIdList + String(featureTableJson.data[i].feature_id) + ",";
	}

	featureIdList = featureIdList + String(featureTableJson.data[featureTableJson.data.length-1].feature_id);

	$('#isolationHostView').click( function() {
		$('#pubStrainList').empty();
		$('#strainListForm span').hide();
		$('#pubStrainList').append('<div class="progress progress-striped active"><div class="bar" style="width: 100%;">Updating...</div></div>');
		$.ajax({
			type: "POST",
			url: "/host_source_form",
			data: { public_id_list: featureIdList }
		}).done(function (returned_data) {
			$('#pubStrainList').empty();
			$('#strainListForm span').show();
			$('#group1 li').closest('li').remove();
			$('#buttonRemoveGroup1').hide();
			$('#group2 li').closest('li').remove();
			$('#buttonRemoveGroup2').hide();

			var hostSourceTableJsonString = returned_data;
			var hostSourceTableJson = $.parseJSON(hostSourceTableJsonString);

			for (i=0 ; i<hostSourceTableJson.data.length ; i++) {
				var li = document.createElement("li");
				var label = document.createElement("label");
				var description = document.createTextNode(hostSourceTableJson.data[i].value);	

				var checkbox = document.createElement("input");

				li.setAttribute("style","list-style:none");

				label.className = "checkbox";

				checkbox.type = "checkbox";
				checkbox.id = "checkboxName";
				checkbox.name = "multiStrainNames";
				checkbox.value = hostSourceTableJson.data[i].feature_id;

				label.appendChild(checkbox);
				label.appendChild(description);
				li.appendChild(label);

				document.getElementById('pubStrainList').appendChild(li);
			}
		});
});

	$('#isolationSourceView').click( function() {
		$('#pubStrainList').empty();
		$('#strainListForm span').hide();
		$('#pubStrainList').append('<div class="progress progress-striped active"><div class="bar" style="width: 100%;">Updating...</div></div>');
		$.ajax({
			type: "POST",
			url: "/isolation_source_form",
			data: { public_id_list: featureIdList }
		}).done(function (returned_data) {
			$('#pubStrainList').empty();
			$('#strainListForm span').show();
			$('#group1 li').closest('li').remove();
			$('#buttonRemoveGroup1').hide();
			$('#group2 li').closest('li').remove();
			$('#buttonRemoveGroup2').hide();

			var hostSourceTableJsonString = returned_data;
			var hostSourceTableJson = $.parseJSON(hostSourceTableJsonString);

			for (i=0 ; i<hostSourceTableJson.data.length ; i++) {
				var li = document.createElement("li");
				var label = document.createElement("label");
				var description = document.createTextNode(hostSourceTableJson.data[i].value);

				var checkbox = document.createElement("input");

				li.setAttribute("style","list-style:none");

				label.className = "checkbox";

				checkbox.type = "checkbox";
				checkbox.id = "checkboxName";
				checkbox.name = "multiStrainNames";
				checkbox.value = hostSourceTableJson.data[i].feature_id;

				label.appendChild(checkbox);
				label.appendChild(description);
				li.appendChild(label);

				document.getElementById('pubStrainList').appendChild(li);
			}
		});
});

	$('#serotypeView').click( function() {
		$('#pubStrainList').empty();
		$('#strainListForm span').hide();
		$('#pubStrainList').append('<div class="progress progress-striped active"><div class="bar" style="width: 100%;">Updating...</div></div>');
		$.ajax({
			type: "POST",
			url: "/serotype_form",
			data: { public_id_list: featureIdList }
		}).done(function (returned_data) {
			$('#pubStrainList').empty();
			$('#strainListForm span').show();
			$('#group1 li').closest('li').remove();
			$('#buttonRemoveGroup1').hide();
			$('#group2 li').closest('li').remove();
			$('#buttonRemoveGroup2').hide();

			var hostSourceTableJsonString = returned_data;
			var hostSourceTableJson = $.parseJSON(hostSourceTableJsonString);

			for (i=0 ; i<hostSourceTableJson.data.length ; i++) {
				var li = document.createElement("li");
				var label = document.createElement("label");
				var description = document.createTextNode(hostSourceTableJson.data[i].value);

				var checkbox = document.createElement("input");

				li.setAttribute("style","list-style:none");

				label.className = "checkbox";

				checkbox.type = "checkbox";
				checkbox.id = "checkboxName";
				checkbox.name = "multiStrainNames";
				checkbox.value = hostSourceTableJson.data[i].feature_id;

				label.appendChild(checkbox);
				label.appendChild(description);
				li.appendChild(label);

				document.getElementById('pubStrainList').appendChild(li);
			}
		});
});

	$('#isolationDateView').click( function() {
		$('#pubStrainList').empty();
		$('#strainListForm span').hide();
		$('#pubStrainList').append('<div class="progress progress-striped active"><div class="bar" style="width: 100%;">Updating...</div></div>');
		$.ajax({
			type: "POST",
			url: "/isolation_date_form",
			data: { public_id_list: featureIdList }
		}).done(function (returned_data) {
			$('#pubStrainList').empty();
			$('#strainListForm span').show();
			$('#group1 li').closest('li').remove();
			$('#buttonRemoveGroup1').hide();
			$('#group2 li').closest('li').remove();
			$('#buttonRemoveGroup2').hide();

			var hostSourceTableJsonString = returned_data;
			var hostSourceTableJson = $.parseJSON(hostSourceTableJsonString);

			for (i=0 ; i<hostSourceTableJson.data.length ; i++) {
				var li = document.createElement("li");
				var label = document.createElement("label");
				var description = document.createTextNode(hostSourceTableJson.data[i].value);

				var checkbox = document.createElement("input");

				li.setAttribute("style","list-style:none");

				label.className = "checkbox";

				checkbox.type = "checkbox";
				checkbox.id = "checkboxName";
				checkbox.name = "multiStrainNames";
				checkbox.value = hostSourceTableJson.data[i].feature_id;

				label.appendChild(checkbox);
				label.appendChild(description);
				li.appendChild(label);

				document.getElementById('pubStrainList').appendChild(li);
			}
		});
});


	$('#isolationLocationView').click( function() {
		$('#pubStrainList').empty();
		$('#strainListForm span').hide();
		$('#pubStrainList').append('<div class="progress progress-striped active"><div class="bar" style="width: 100%;">Updating...</div></div>');
		$.ajax({
			type: "POST",
			url: "/isolation_location_form",
			data: { public_id_list: featureIdList }
		}).done(function (returned_data) {
			$('#pubStrainList').empty();
			$('#strainListForm span').show();
			$('#group1 li').closest('li').remove();
			$('#buttonRemoveGroup1').hide();
			$('#group2 li').closest('li').remove();
			$('#buttonRemoveGroup2').hide();

			var hostSourceTableJsonString = returned_data;
			var hostSourceTableJson = $.parseJSON(hostSourceTableJsonString);

			for (i=0 ; i<hostSourceTableJson.data.length ; i++) {
				var li = document.createElement("li");
				var label = document.createElement("label");
				var description = document.createTextNode(hostSourceTableJson.data[i].value);

				var checkbox = document.createElement("input");

				li.setAttribute("style","list-style:none");

				label.className = "checkbox";

				checkbox.type = "checkbox";
				checkbox.id = "checkboxName";
				checkbox.name = "multiStrainNames";
				checkbox.value = hostSourceTableJson.data[i].feature_id;

				label.appendChild(checkbox);
				label.appendChild(description);
				li.appendChild(label);

				document.getElementById('pubStrainList').appendChild(li);
			}
		});
});

});

	</script>

	</html>
