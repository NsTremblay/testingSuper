<!DOCTYPE html>
<html>

<TMPL_INCLUDE NAME="header.tmpl">

<script src="/App/Styling/js/jquery-1.9.1.js"></script>
<script src="/App/Styling/js/jquery-ui-1.10.1.js"></script>
<link rel="stylesheet" href="/App/Styling/css/jquery-ui-1.10.1.css">

<TMPL_INCLUDE NAME="nav_bar_viewing_options.tmpl">

<body onload="onLoadCheck()" style="background-color:#796e6c">
	<div class="container" style="background-color:#FFFFFF">
		
		<div style="margin:10px 10px 10px 10px;padding:10px 10px 10px 10px"><h1>Group Wise Comparisons</h1></div>

		<span class="help-block" style="margin:0px 10px 20px 10px">Select 1 or more strains from the list below. You can perform group wise comparisons of your selected strains for the presence/absence of numerous loci and snps, generated from our cutting edge PanSeq analysis platform.</span>
		
		<div><TMPL_INCLUDE NAME="group_wise_comparison_form.tmpl"></div>
		
		<!--span class="help-block" style="padding:10px">Soon you will be able to select groups of strains from the map or the phylogenetic tree, but they are both shown here for reference as to what the site will look like</span-->

		<div id="wheel-loader" style="margin:30px 0px 0px 0px;display:none" align="middle"><small><em><img src="/App/Pictures/wheel-loader.gif"> Loading Info...</em></small></div>
		
		<div class="tabbable tabs-left">
			<ul class="nav nav-tabs">
				<!--li class="active"><a href="#mapTreeSelect" data-toggle="tab">Strain Selections</a></li-->
				<li class="active" id="groupWiseDataLink" style="display:none"><a href="#groupWiseData" data-toggle="tab">Data</a></li>
			</ul>
			<div class="tab-content">
				<!--div class="tab-pane active" id="mapTreeSelect">
					<div class="tabbable">
						<ul class="nav nav-tabs">
							<li class="active"><a href="#mapSelect" data-toggle="tab">Select from Map</a></li>
						</ul>
						<div class="tab-content">
							<div class="tab-pane active" id="mapSelect">
								<div id="map_div" style="border-style:solid;border-width:1px;border-color:#d3d3d3;margin:0px 10px 10px 0px;padding:10px"><div id="map_canvas" style="height:300px"></div></div>
							</div>
						</div>
					</div>
				</div-->
				<div class="tab-pane active" id="groupWiseData" style="display:none">
					<div class="tabbable">
						<ul class="nav nav-tabs">
							<li class="active"><a href="#binaryData" data-toggle="tab">Binary Data</a></li>
							<li><a href="#snpData" data-toggle="tab">SNP Data</a></li>
							<li><a href="#groupWisePhyloTree" data-toggle="tab">Phylogram</a></li>
						</ul>
						<div class="tab-content">
							<div class="tab-pane active" id="binaryData">
								<div class="row-fluid">
									<h4 style="margin:10px">Binary Data</h4>
									<div class="span5" style="margin:10px;height:300px;overflow:auto">
										<span class="help-block">Group 1</span>
										<table id="binaryTableGroup1" class="table table-striped table-condensed">
										</table>
									</div>
									<div class="span5 pull-right" style="margin:10px;height:300px;overflow:auto">
										<span class="help-block">Group 2</span>
										<table id="binaryTableGroup2" class="table table-striped table-condensed">
										</table>
									</div>
								</div> 
							</div>
							<div class="tab-pane" id="snpData">
								<div class="row-fluid">
									<h4 style="margin:10px">SNP Data</h4>
									<div class="span5" style="margin:10px;height:300px;overflow:auto">
										<span class="help-block">Group 1</span>
										<table id="snpTableGroup1" class="table table-striped table-condensed">
										</table>
									</div>
									<div class="span5 pull-right" style="margin:10px;height:300px;overflow:auto">
										<span class="help-block">Group 2</span>
										<table id="snpTableGroup2" class="table table-striped table-condensed">
										</table>
									</div>
								</div> 
							</div>

							<div class="tab-pane" id="groupWisePhyloTree">
								<div id="svgCanvas" style="padding:5px">
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id="validator" style="display:none"><TMPL_VAR NAME=VALIDATOR></div>
</body>

<TMPL_INCLUDE NAME="footer.tmpl">

</html>

<script type="text/javascript">
/*Global variables set here*/
google.maps.visualRefresh = true;

var FEATURE_TABLE_JSON = <TMPL_VAR NAME=strainJSONData>;
/* 
Back lists that will get called to the client after page has loaded.
These remain as global constants.
*/
var ISOLATION_LOCATION_JSON = {};
var SEROTYPE_JSON = {};
var ISOLATION_HOST_JSON = {};
var ISOLATION_SOURCE_JSON = {};
var ISOLATION_DATE_JSON = {};

//List of public feature ids used to get data for view switching 
var featureIdList = "";
$(document).ready(function() {
	for (i=0 ; i<FEATURE_TABLE_JSON.data.length-1 ; i++) {
		featureIdList = featureIdList + String(FEATURE_TABLE_JSON.data[i].feature_id) + ",";
	}
	featureIdList = featureIdList + String(FEATURE_TABLE_JSON.data[FEATURE_TABLE_JSON.data.length-1].feature_id);
});

/*Functions set here*/
function onLoadCheck() {
	initialize();
}

//Will initialize the map and grab all of the lists needed for form switching.
function initialize() {
	getBackList('/isolation_location_form' , ISOLATION_LOCATION_JSON, 'isolationLocationLabel', 'isolationLocationView');
	getBackList("/serotype_form" , SEROTYPE_JSON, 'serotypeViewLabel', 'serotypeView');
	getBackList("/host_source_form" , ISOLATION_HOST_JSON, 'isolationHostLabel', 'isolationHostView');
	getBackList("/isolation_source_form" , ISOLATION_SOURCE_JSON, 'isolationSourceLabel', 'isolationSourceView');
	getBackList("/isolation_date_form" , ISOLATION_DATE_JSON, 'isolationDateLabel', 'isolationDateView');
	getBackList('/isolation_location_form' , ISOLATION_LOCATION_JSON, 'isolationLocationLabel', 'isolationLocationView');

	var LatLng1 = new google.maps.LatLng(49.134890, -122.901435);

	var mapOptions = {	
		center: LatLng1,
		zoom: 2,
		mapTypeId: google.maps.MapTypeId.ROADMAP
	};

	var map = new google.maps.Map(document.getElementById("map_canvas"),
		mapOptions);
}

function getBackList(urlName,formType,labelId,radioId) {
	$.ajax({
		type: "POST",
		url: urlName,
		data: { public_id_list: featureIdList }
	}).done(function (returned_data) {
		formType.json = $.parseJSON(returned_data);
		$('#'+radioId).attr('disabled',false);
		$('#'+labelId+'Loading').hide();
		$('#'+labelId).show();
	});
}

/*
The next functions are for switching form views:
*/

$('#commonNameView').click(function () {
	showCommonNames(FEATURE_TABLE_JSON);
});
$('#accessionNumberView').click(function () {
	showAccessionNumbers(FEATURE_TABLE_JSON);
});
$('#isolationHostView').click(function () {
	changeListView(ISOLATION_HOST_JSON.json);
});
$('#isolationSourceView').click(function () {
	changeListView(ISOLATION_SOURCE_JSON.json);
});
$('#serotypeView').click(function () {
	changeListView(SEROTYPE_JSON.json);
});
$('#isolationDateView').click(function () {
	changeListView(ISOLATION_DATE_JSON.json);
});
$('#isolationLocationView').click(function () {
	changeListView(ISOLATION_LOCATION_JSON.json);
});

function showCommonNames(featureJsonList) {
	$('#pubStrainList').empty();
	$('#group1 li').closest('li').remove();
	$('#buttonRemoveGroup1').hide();
	$('#group2 li').closest('li').remove();
	$('#buttonRemoveGroup2').hide();

	for (i=0 ; i<featureJsonList.data.length ; i++) {
		var li = document.createElement("li");
		var label = document.createElement("label");
		var description = document.createTextNode(featureJsonList.data[i].name);
		var checkbox = document.createElement("input");

		li.setAttribute("style","list-style:none");

		label.className = "checkbox";

		checkbox.type = "checkbox";
		checkbox.id = "checkboxName";
		checkbox.name = "multiStrainNames";
		checkbox.value = featureJsonList.data[i].feature_id;

		label.appendChild(checkbox);
		label.appendChild(description);
		li.appendChild(label);

		document.getElementById('pubStrainList').appendChild(li);
	}
}

function showAccessionNumbers(featureJsonList) {

	$('#pubStrainList').empty();
	$('#group1 li').closest('li').remove();
	$('#buttonRemoveGroup1').hide();
	$('#group2 li').closest('li').remove();
	$('#buttonRemoveGroup2').hide();

	for (i=0 ; i<featureJsonList.data.length ; i++) {

		var li = document.createElement("li");
		var label = document.createElement("label");
		var description = document.createTextNode(featureJsonList.data[i].dbxref.accession);

		var checkbox = document.createElement("input");

		li.setAttribute("style","list-style:none");

		label.className = "checkbox";

		checkbox.type = "checkbox";
		checkbox.id = "checkboxName";
		checkbox.name = "multiStrainNames";
		checkbox.value = featureJsonList.data[i].feature_id;

		label.appendChild(checkbox);
		label.appendChild(description);
		li.appendChild(label);

		document.getElementById('pubStrainList').appendChild(li);
	}
}

function changeListView(jsonList) {
	$('#pubStrainList').empty();
	$('#strainListForm span').show();
	$('#group1 li').closest('li').remove();
	$('#buttonRemoveGroup1').hide();
	$('#group2 li').closest('li').remove();
	$('#buttonRemoveGroup2').hide();

	for (i=0 ; i<jsonList.data.length ; i++) {
		var li = document.createElement("li");
		var label = document.createElement("label");
		var description = document.createTextNode(jsonList.data[i].value + ' - ' + jsonList.data[i].common_name);	

		var checkbox = document.createElement("input");

		li.setAttribute("style","list-style:none");

		label.className = "checkbox";

		checkbox.type = "checkbox";
		checkbox.id = "checkboxName";
		checkbox.name = "multiStrainNames";
		checkbox.value = jsonList.data[i].feature_id;

		label.appendChild(checkbox);
		label.appendChild(description);
		li.appendChild(label);

		document.getElementById('pubStrainList').appendChild(li);
	}
}

</script>